{% liquid
  assign id = section.id
%}
{{ 'customer.css' | asset_url | stylesheet_tag }}
<style>
  #shopify-section-{{id}} {
    box-sizing: border-box;
    margin-top: {{section.settings.margin_top | append: 'px'}};
    margin-bottom: {{section.settings.margin_bottom | append: 'px'}};
    padding-top: {{section.settings.padding_top | append: 'px'}};
    padding-bottom: {{section.settings.padding_bottom | append: 'px'}};
    table, th, td {
      {% comment %} border: 1px solid black;  {% endcomment %}
    }

  }
  .wrapper-{{ id }} {
    display: grid;
    grid-template-columns: 1fr 3fr;
    gap: 15px;
    align-items: stretch;
    span.icon {
        line-height: 1;
    }
    ul.cca__nav__ {
        background-color: #F6F6F6;
        padding: 3rem;
        height: max-content;
        li {
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            padding: 0 1.5rem;
            height: 5rem;
            font-size: 1.6rem;
            font-weight: 400;
            text-transform: capitalize;
            color: #707070;
            gap: 10px;
            -webkit-transition: all 0.3s linear;
            transition: all 0.3s linear;
            cursor: pointer;
        }
        li.active {
          background-color: #EBEBEB;
          color: #000;
          font-weight: 500;
        }
    }
    .my__profile__wrap__ h2, .my__order__wrap__ h2 {
        margin: 0 0 2rem;
        font-family: "Jost", sans-serif;
        font-size: 2.4rem;
        font-weight: 600;
        text-transform: uppercase;
        color: var(--black);
        line-height: 1.3;
    }
    .box__ {
        position: relative;
        display: flex;
        flex-direction: column;
        min-width: 0;
        word-wrap: break-word;
        background-color: #fff;
        background-clip: border-box;
        border: 1px solid rgba(0,0,0,.125);
        border-radius: .25rem;
    }
    .top__, .bottom__ {
        padding: 15px;
        position: relative;
    }
    .bottom__ {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
    }
    .top__::after {
        content: "";
        background: rgba(0, 0, 0, .125);
        height: 1px;
        width: calc(100% - 30px);
        position: absolute;
        left: 50%;
        bottom: 0;
        transform: translatex(-50%);
    }
    .top__ p {
      margin: 0;
    }
    .child_content__ h3 {
        color: #777777;
        {% comment %} margin: 0 0 4px; {% endcomment %}
        font-size: 16px;
        line-height: 100%;
    }
    .child_content__ .cc__heading {
        font-size: 18px;
        line-height: 100%;
    }
  }
    .cc__heading {
      margin: 0 0 15px;
    }
    .m4 {
        margin: 0 0 4px !important;
    }
    .my__order__wrap__  .bottom__ {
        display: grid;
        grid-template-columns: 1fr;
    }
    table.order-history {
        {% comment %} border-collapse: collapse; {% endcomment %}
    }
    .order-history th, tr, td {
      text-align: left;
      padding: 3px 10px;
    }
    @media(max-width: 600px) {
    #shopify-section-{{id}} {
      margin-top: {{section.settings.margin_top_m | append: 'px'}};
      margin-bottom: {{section.settings.margin_bottom_m | append: 'px'}};
      padding-top: {{section.settings.padding_top_m | append: 'px'}};
      padding-bottom: {{section.settings.padding_bottom_m | append: 'px'}};
    }
  }
</style>

<div class="sec-{{ id }} custom__customer--account">
  <div class="{% unless section.settings.full_width %}page-width{% endunless %}">
    <div class="wrapper-{{ id }}">
      <ul class="cca__nav__">
        <li class="active" data-title="my-profile" id="my-profile">
          <span class="icon">{% render 'all-icons', name: 'file' %}</span>My Profile
        </li>
        <li class="" data-title="my-orders" id="my-orders">
          <span class="icon">{% render 'all-icons', name: 'file' %}</span>My Orders
        </li>
      </ul>
      <div class="my__profile__wrap__ "   data-title="my-profile">
        <h2>My Profile</h2>
        <div class="box__">
          <div class="top__">
            <h3 class="h2 cc__heading">Your Addresses</h3>
            <p>Manage your billing and shipping addresss.</p>
            <a href="{{ routes.account_addresses_url }}">Edit</a>
          </div>
          <div class="bottom__">
            <!-- Shipping Address -->
            <div class="child_content__">
              <h3 class="cc__heading h3">Shipping Address</h3>
              <h3 class="h3 m4">{{ customer.name }}</h3>
              {% if customer.default_address %}
                {% render 'address-details', address: customer.default_address %}
              {% else %}
                <p>No shipping address on file.</p>
              {% endif %}
            </div>

            <!-- Billing Address -->
            <div class="child_content__">
              <h3 class="cc__heading h3">Billing Address</h3>
              <h3 class="h3 m4">{{ customer.name }}</h3>

              {% comment %}
                Find the most recent order with a billing address
              {% endcomment %}
              {% assign billing_address = customer.default_address %}
              {% assign latest_date = '0000-01-01T00:00:00Z' %}
              {% comment %} Fallback old date {% endcomment %}
              {% assign found = false %}

              {% for order in customer.orders %}
                {% if order.created_at > latest_date and order.billing_address %}
                  {% assign latest_date = order.created_at %}
                  {% assign billing_address = order.billing_address %}
                  {% assign found = true %}
                {% endif %}
              {% endfor %}

              {% if billing_address %}
                {% render 'address-details', address: billing_address %}
              {% else %}
                <p>No billing address on file. Using shipping address as fallback.</p>
                {% render 'address-details', address: customer.default_address %}
              {% endif %}
            </div>
          </div>
        </div>
      </div>
      <div class="my__order__wrap__ hidden" data-title="my-orders">
        <h2>My Orders</h2>
        <div class="box__">
          <div class="bottom__">
          {% paginate customer.orders by 20 %}
            {%- if customer.orders.size > 0 -%}
              <table role="table" class="order-history" border="1" cellspacing="0">
                <caption class="visually-hidden">
                  {{ 'customer.orders.title' | t }}
                </caption>
                <thead role="rowgroup">
                  <tr role="row">
                    <th id="ColumnOrder" scope="col" role="columnheader">{{ 'customer.orders.order_number' | t }}</th>
                    <th id="ColumnDate" scope="col" role="columnheader">{{ 'customer.orders.date' | t }}</th>
                    <th id="ColumnPayment" scope="col" role="columnheader">
                      {{ 'customer.orders.payment_status' | t }}
                    </th>
                    <th id="ColumnFulfillment" scope="col" role="columnheader">
                      {{ 'customer.orders.fulfillment_status' | t }}
                    </th>
                    <th id="ColumnTotal" scope="col" role="columnheader">{{ 'customer.orders.total' | t }}</th>
                  </tr>
                </thead>
                <tbody role="rowgroup">
                  {%- for order in customer.orders -%}
                    <tr role="row">
                      <td
                        id="RowOrder"
                        role="cell"
                        headers="ColumnOrder"
                        data-label="{{ 'customer.orders.order_number' | t }}"
                      >
                        <a
                          href="{{ order.customer_url }}"
                          aria-label="{{ 'customer.orders.order_number_link' | t: number: order.name }}"
                        >
                          {{ order.name }}
                        </a>
                      </td>
                      <td headers="RowOrder ColumnDate" role="cell" data-label="{{ 'customer.orders.date' | t }}">
                        {{ order.created_at | time_tag: format: 'date' }}
                      </td>
                      <td
                        headers="RowOrder ColumnPayment"
                        role="cell"
                        data-label="{{ 'customer.orders.payment_status' | t }}"
                      >
                        {{ order.financial_status_label }}
                      </td>
                      <td
                        headers="RowOrder ColumnFulfillment"
                        role="cell"
                        data-label="{{ 'customer.orders.fulfillment_status' | t }}"
                      >
                        {{ order.fulfillment_status_label }}
                      </td>
                      <td headers="RowOrder ColumnTotal" role="cell" data-label="{{ 'customer.orders.total' | t }}">
                        {{ order.total_net_amount | money_with_currency }}
                      </td>
                    </tr>
                  {%- endfor -%}
                </tbody>
              </table>
            {%- else -%}
              <p>{{ 'customer.orders.none' | t }}</p>
            {%- endif -%}

            {%- if paginate.pages > 1 -%}
              {%- if paginate.parts.size > 0 -%}
                <nav class="pagination" role="navigation" aria-label="{{ 'general.pagination.label' | t }}">
                  <ul role="list">
                    {%- if paginate.previous -%}
                      <li>
                        <a href="{{ paginate.previous.url }}" aria-label="{{ 'general.pagination.previous' | t }}">
                          <span class="svg-wrapper">
                            {{- 'icon-caret.svg' | inline_asset_content -}}
                          </span>
                        </a>
                      </li>
                    {%- endif -%}

                    {%- for part in paginate.parts -%}
                      <li>
                        {%- if part.is_link -%}
                          <a href="{{ part.url }}" aria-label="{{ 'general.pagination.page' | t: number: part.title }}">
                            {{- part.title -}}
                          </a>
                        {%- else -%}
                          {%- if part.title == paginate.current_page -%}
                            <span
                              aria-current="page"
                              aria-label="{{ 'general.pagination.page' | t: number: part.title }}"
                            >
                              {{- part.title -}}
                            </span>
                          {%- else -%}
                            <span>{{ part.title }}</span>
                          {%- endif -%}
                        {%- endif -%}
                      </li>
                    {%- endfor -%}

                    {%- if paginate.next -%}
                      <li>
                        <a href="{{ paginate.next.url }}" aria-label="{{ 'general.pagination.next' | t }}">
                          <span class="svg-wrapper">
                            {{- 'icon-caret.svg' | inline_asset_content -}}
                          </span>
                        </a>
                      </li>
                    {%- endif -%}
                  </ul>
                </nav>
              {%- endif -%}
            {%- endif -%}
          {% endpaginate %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const profileTab   = document.querySelector("#my-profile");
  const ordersTab    = document.querySelector("#my-orders");
  const profileWrap  = document.querySelector(".my__profile__wrap__");
  const ordersWrap   = document.querySelector(".my__order__wrap__");

  if (!profileTab || !ordersTab || !profileWrap || !ordersWrap) {
    console.warn("Tab elements not found â€“ check your HTML selectors");
    return;
  }
  function switchTab(showTab, showWrap, hideTab, hideWrap) {
    showTab.classList.add("active");
    showWrap.classList.remove("hidden");
    
    hideTab.classList.remove("active");
    hideWrap.classList.add("hidden");
  }

  profileTab.addEventListener("click", () => {
    switchTab(profileTab, profileWrap, ordersTab, ordersWrap);
  });

  ordersTab.addEventListener("click", () => {
    switchTab(ordersTab, ordersWrap, profileTab, profileWrap);
  });

});
</script>

{% schema %}
{
  "name": "My Account",
  "settings": [
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Full Width Section",
      "default": false
    },
    {
      "type": "header",
      "content": "Section Spacing Desktop"
    },
    {
      "type": "range",
      "id": "margin_top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Margin Top",
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Margin Bottom",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding Top",
      "default": 48
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 48
    },
    {
      "type": "header",
      "content": "Section Spacing Mobile"
    },
    {
      "type": "range",
      "id": "margin_top_m",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Margin Top",
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_bottom_m",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Margin Bottom",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_top_m",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding Top",
      "default": 32
    },
    {
      "type": "range",
      "id": "padding_bottom_m",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 32
    }
  ],
  "presets": [
    {
      "name": "My Account"
    }
  ]
}
{% endschema %}
